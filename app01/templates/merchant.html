<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å•†å®¶åå°</title>
    <style>
    /* ========== æºç¨‹é£æ ¼é…è‰²æ–¹æ¡ˆ ========== */
    :root {
        --ctrip-blue: #10478a;         /* æºç¨‹å“ç‰Œè“ */
        --ctrip-orange: #4A90E2;
        {#FF6A00  æºç¨‹å“ç‰Œæ©™#}
        --ctrip-light-blue: #4A90E2;   /* è¾…åŠ©è“è‰² */
        --success-green: #4A90E2;
        --danger-red: #E53935;         /* è­¦ç¤ºçº¢ */
        --bg-light: #F5F7FA;           /* æµ…ç°èƒŒæ™¯ */
        --text-dark: #2D3436;          /* æ·±ç°æ–‡å­— */
        --text-light: #FFFFFF;         /* çº¯ç™½æ–‡å­— */
        --border-color: #DFE3E8;       /* è¾¹æ¡†é¢œè‰² */
        --radius-md: 4px;
        --radius-lg: 8px;
        --shadow-sm: 0 2px 8px rgba(28, 36, 56, 0.08);
        --shadow-md: 0 4px 12px rgba(28, 36, 56, 0.12);
        --shadow-lg: 0 8px 24px rgba(28, 36, 56, 0.16);
        --transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* ========== åŸºç¡€é‡ç½® ========== */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Helvetica Neue', Helvetica, 'PingFang SC', 'å¾®è½¯é›…é»‘', sans-serif;
    }

    body {
        background: var(--bg-light);
        color: var(--text-dark);
        line-height: 1.6;
        -webkit-font-smoothing: antialiased;
    }

    /* ========== ä¾§è¾¹å¯¼èˆªæ  ========== */
    .sidebar {
        width: 240px;
        background: var(--ctrip-blue);
        position: fixed;
        height: 100%;
        box-shadow: var(--shadow-md);
        z-index: 1000;
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .logo {
        color: var(--text-light);
        font-size: 20px;
        font-weight: 500;
        padding: 20px;
        text-align: center;
        border-bottom: 1px solid rgba(255,255,255,0.15);
    }

    .nav-menu {
        padding: 16px;
    }

    .nav-link {
        display: flex;
        align-items: center;
        gap: 12px;
        color: rgba(255,255,255,0.9);
        padding: 12px 16px;
        margin: 8px 0;
        border-radius: var(--radius-md);
        transition: var(--transition);
        text-decoration: none;
        font-size: 14px;
    }

    .nav-link:hover {
        background: rgba(255,255,255,0.15);
        transform: translateX(4px);
    }

    /* ========== ä¸»å†…å®¹åŒº ========== */
    .main-content {
        margin-left: 240px;
        padding: 88px 32px 32px;
        min-height: 100vh;
    }

    .top-nav {
        position: fixed;
        top: 0;
        right: 0;
        left: 240px;
        height: 64px;
        background: var(--text-light);
        box-shadow: var(--shadow-sm);
        display: flex;
        align-items: center;
        justify-content: flex-end;
        padding: 0 24px;
        z-index: 999;
    }

    /* ========== æŒ‰é’®æ ·å¼ ========== */
    .welcome-btn{
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        border-radius: var(--radius-md);
        border: none;
        cursor: pointer;
        font-weight: 500;
        transition: var(--transition);
        background: #71a5e6;
        color: var(--text-light);
        font-size: 14px;
        text-decoration: none !important;
    }


    .user-btn {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        border-radius: var(--radius-md);
        border: none;
        cursor: pointer;
        font-weight: 500;
        transition: var(--transition);
        background: var(--ctrip-orange);
        color: var(--text-light);
        font-size: 14px;
        text-decoration: none !important;
    }

    .user-btn:hover {
        opacity: 0.9;
        transform: translateY(-1px);
        box-shadow: var(--shadow-sm);
    }

    .user-btn.danger {
        background: var(--danger-red);
    }

    .add-dish-btn {
        background: var(--success-green);
    }

    /* ========== åˆ†ç±»è¿‡æ»¤æŒ‰é’® ========== */
    .filter-group {
        display: flex;
        gap: 12px;
        margin: 24px 0;
        flex-wrap: wrap;
    }

    .filter-btn {
        padding: 6px 16px;
        border-radius: 16px;
        border: 1px solid var(--border-color);
        background: var(--text-light);
        color: var(--text-dark);
        cursor: pointer;
        transition: var(--transition);
        font-size: 14px;
    }

    .filter-btn:hover {
        border-color: var(--ctrip-orange);
        color: var(--ctrip-orange);
    }

    .filter-btn.active {
        background: var(--ctrip-orange);
        color: var(--text-light);
        border-color: var(--ctrip-orange);
    }

    /* ========== å¡ç‰‡è®¾è®¡ ========== */
    .dish-card {
        background: var(--text-light);
        border-radius: var(--radius-lg);
        padding: 16px;
        margin: 16px 0;
        box-shadow: var(--shadow-sm);
        transition: var(--transition);
        display: flex;
        justify-content: space-between;
        align-items: center;
        border: 1px solid var(--border-color);
    }

    .dish-card:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
    }

    .dish-info h3 {
        color: var(--ctrip-blue);
        font-size: 16px;
        margin-bottom: 4px;
        font-weight: 600;
    }

    .dish-info p {
        color: #666;
        font-size: 13px;
    }

    /* ç¡®ä¿æœç´¢å®¹å™¨å¯è§ */
    .search-container {
        display: flex;
        gap: 12px;
        margin: 16px 0;
        width: 100%;
        max-width: 600px;
    }

    .search-input {
        flex: 1;
        padding: 10px 16px;
        border: 1px solid var(--border-color);
        border-radius: 24px;
        transition: var(--transition);
    }

    .search-input:focus {
        border-color: var(--ctrip-orange);
        box-shadow: 0 0 0 3px rgba(255, 106, 0, 0.15);
    }

    /* ç§»åŠ¨ç«¯èœå•æŒ‰é’®æ ·å¼ */
    .menu-toggle {
        position: fixed;
        top: 16px;
        left: 16px;
        z-index: 2000;
        display: none;
        padding: 8px 12px;
        background: #1A2F6B;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

    @media (max-width: 768px) {
        .menu-toggle {
            display: block;
        }
    }

    /* ========== è¡¨å•æ ·å¼ ========== */
    .dish-form {
        background: var(--text-light);
        border-radius: var(--radius-lg);
        padding: 24px;
        box-shadow: var(--shadow-sm);
        margin-bottom: 24px;
        border: 1px solid var(--border-color);
    }

    .form-group {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
        margin-top: 16px;
    }

    input, select, textarea {
        width: 100%;
        padding: 10px 14px;
        border: 1px solid var(--border-color);
        border-radius: var(--radius-md);
        transition: var(--transition);
        font-size: 14px;
        background: var(--text-light);
    }

    input:focus, select:focus {
        outline: none;
        border-color: var(--ctrip-orange);
        box-shadow: 0 0 0 3px rgba(255, 106, 0, 0.15);
    }

    /* ========== åŠ è½½åŠ¨ç”» ========== */
    .loading-mask {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255,255,255,0.9);
        display: none;
        place-items: center;
        z-index: 2000;
    }

    .loading-spinner {
        width: 40px;
        height: 40px;
        border: 3px solid var(--border-color);
        border-top-color: var(--ctrip-orange);
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    /* ========== é”™è¯¯æç¤º ========== */
    .error-msg {
        padding: 12px 16px;
        background: #FFF5F5;
        color: var(--danger-red);
        border-radius: var(--radius-md);
        margin-top: 16px;
        display: flex;
        align-items: center;
        gap: 8px;
        border: 1px solid #FED7D7;
        font-size: 14px;
    }

    /* ========== ç¼–è¾‘è¡¨å• ========== */
    .edit-form-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.5);
        display: none;
        place-items: center;
        z-index: 2000;
    }

    .edit-form {
        background: var(--text-light);
        padding: 24px;
        border-radius: var(--radius-lg);
        width: 90%;
        max-width: 500px;
        box-shadow: var(--shadow-lg);
        border: 1px solid var(--border-color);
    }

    #orders .merchant-order-card {
        background: white;
        border-radius: 8px;
        padding: 24px;
        margin: 16px 0;
        box-shadow: 0 2px 8px rgba(28, 36, 56, 0.08);
        border-left: 4px solid transparent;
    }

    #orders .order-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid #F0F2F5;
        padding-bottom: 16px;
        margin-bottom: 20px;
    }

    #orders .order-id {
        font-size: 16px;
        font-weight: 600;
        color: #1A2F6B;
    }

    #orders .order-id .value {
        color: #4091F7;
        margin-left: 8px;
    }

    #orders .order-body {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 24px;
        margin-bottom: 20px;
    }

    #orders .order-body h4 {
        font-size: 14px;
        color: #6B7A8F;
        margin-bottom: 12px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    #global-templates {
      position: absolute;
      left: -9999px;
      visibility: hidden;
    }

    .password-form {
        background: var(--text-light);
        border-radius: var(--radius-lg);
        padding: 24px;
        margin-top: 24px;
        box-shadow: var(--shadow-sm);
    }

    .password-form h3 {
        color: var(--ctrip-blue);
        margin-bottom: 16px;
        font-size: 18px;
    }

    #change-password-form .form-group {
        margin-bottom: 16px;
    }

    #change-password-form input[type="password"] {
        width: 100%;
        padding: 10px 16px;
        border: 1px solid var(--border-color);
        border-radius: var(--radius-md);
        transition: var(--transition);
    }

    #change-password-form input:focus {
        border-color: var(--ctrip-orange);
        box-shadow: 0 0 0 3px rgba(255, 106, 0, 0.15);
    }


    /* ========== å“åº”å¼è®¾è®¡ ========== */
    @media (max-width: 768px) {
        .sidebar {
            transform: translateX(-100%);
            width: 280px;
        }

        .main-content {
            margin-left: 0;
            padding: 88px 16px 16px;
        }

        .top-nav {
            left: 0;
            padding: 0 16px;
        }

        .menu-toggle {
            display: block;
        }

        .filter-group {
            gap: 8px;
        }

        /* è®¢å•å¡ç‰‡æ ·å¼ */
        #orders .merchant-order-card {
            padding: 16px;
            margin: 16px 0;
            border-radius: 8px;
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #eee;
            padding-bottom: 12px;
            margin-bottom: 16px;
        }

        .order-status {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .status-text {
            font-weight: 500;
        }

        /* ä¸åŒçŠ¶æ€çš„é¢œè‰² */
        #orders [data-status="pending"] .status-dot { background: #f59e0b; }
        [data-status="active"] .status-dot { background: #3b82f6; }
        [data-status="completed"] .status-dot { background: #10b981; }
        [data-status="canceled"] .status-dot { background: #ef4444; }

        .order-body {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        .dishes-items {
            margin: 8px 0;
        }


        .order-total {
            text-align: right;
            font-weight: 600;
            margin-top: 12px;
            color: var(--ctrip-blue);
        }

        .rider-info {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid #eee;
        }


        /* çŠ¶æ€æ ‡ç­¾æ ·å¼ */
        .order-status {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
        }

        /* ä¿®æ”¹åï¼ˆæ·»åŠ #orderså‰ç¼€ï¼‰ */
        #orders [data-status="pending"] {
            border-left-color: #FFB020;
        }
        #orders [data-status="pending"] .order-status {
            background: #FFF4E5;
            color: #FFB020;
        }

        [data-status="active"] {
            border-left-color: #4091F7;
        }
        [data-status="active"] .order-status {
            background: #E8F2FF;
            color: #4091F7;
        }

        [data-status="completed"] {
            border-left-color: #14C9A2;
        }
        [data-status="completed"] .order-status {
            background: #E6F9F5;
            color: #14C9A2;
        }

        [data-status="canceled"] {
            border-left-color: #F54E4E;
        }
        [data-status="canceled"] .order-status {
            background: #FFEEEE;
            color: #F54E4E;
        }

        /* è®¢å•å¤´éƒ¨å¸ƒå±€ */
        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid #F0F2F5;
        }

        .order-id {
            font-size: 16px;
            font-weight: 600;
            color: #1A2F6B;
        }

        .order-id .value {
            color: #4091F7;
            margin-left: 8px;
        }

        /* è®¢å•ä¸»ä½“å¸ƒå±€ */
        .order-body {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 20px;
        }

        .order-body h4 {
            font-size: 14px;
            color: #6B7A8F;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* å®¢æˆ·ä¿¡æ¯æ ·å¼ */
        .customer-info p {
            margin: 8px 0;
            color: #4A5568;
            font-size: 14px;
        }

        /* èœå“åˆ—è¡¨æ ·å¼ */
        .dishes-items {
            background: #F8FAFC;
            border-radius: 8px;
            padding: 12px;
        }

        .dish-item {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid #EDF2F7;
            align-items: center;
        }

        .dish-item:last-child {
            border-bottom: none;
        }

        .dish-item span {
            font-size: 14px;
            color: #4A5568;
        }

        /* æ€»ä»·æ ·å¼ */
        .order-total {
            margin-top: 16px;
            font-size: 16px;
            font-weight: 600;
            color: #1A2F6B;
        }

        /* éª‘æ‰‹ä¿¡æ¯æ ·å¼ */
        .rider-info {
            background: #F8FAFC;
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
        }

        .rider-info p {
            margin: 8px 0;
            color: #4A5568;
            font-size: 14px;
        }
    }
</style>
</head>
<body>
    <div class="menu-toggle"></div>
    <div class="container">
        <!-- å·¦ä¾§å¯¼èˆªæ ï¼ˆä¿æŒä¸éª‘æ‰‹ç«¯ç›¸åŒDOMç»“æ„ï¼‰ -->
        <nav class="sidebar" aria-label="ä¸»èœå•">
            <div class="logo">å•†å®¶ä¸­å¿ƒ</div>
            <ul class="nav-menu">
                <!-- ä½¿ç”¨data-typeå±æ€§ä¿æŒä¸éª‘æ‰‹ç«¯ç›¸åŒäº¤äº’é€»è¾‘ -->
                <li><a href="#" class="nav-link" data-type="dishes">ğŸ” èœå“ç®¡ç†</a></li>
                <li><a href="#" class="nav-link" data-type="orders">ğŸ“¦ è®¢å•ç®¡ç†</a></li>
                <li><a href="#" class="nav-link" data-type="settings">âš™ï¸ åº—é“ºè®¾ç½®</a></li>
            </ul>
        </nav>

        <!-- é¡¶éƒ¨å¯¼èˆªï¼ˆç»“æ„ä¸éª‘æ‰‹ç«¯ä¸€è‡´ï¼‰ -->
        <header class="top-nav">
            <nav class="user-menu">
                <span class="welcome-btn">ğŸ‘‹ æ¬¢è¿æ‚¨ï¼Œ{{ merchant_name }}</span>
                <a href="/logout/" class="welcome-btn">ğŸšª é€€å‡ºç™»å½•</a>
            </nav>
        </header>

        <!-- ä¸»å†…å®¹åŒºåŸŸï¼ˆæŒ‰åŠŸèƒ½åˆ†åŒºï¼‰ -->
        <main class="main-content">
            <!-- èœå“ç®¡ç†åŒºåŸŸ -->
            <section id="dishes" style="display: none;">
                <div class="section-header" style="display: flex; justify-content: space-between; align-items: center;">
                <h2>èœå“ç®¡ç†</h2>
                <div class="search-container">
                    <input type="text" class="search-input" placeholder="æœç´¢èœå“åç§°..." id="dish-search">
                    <button class="user-btn search-btn" onclick="handleSearch()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"/>
                            <path d="M21 21l-4.35-4.35"/>
                        </svg>
                        æœç´¢
                    </button>
                </div>
                </div>

                <!-- åœ¨èœå“è¡¨å•ä¸‹æ–¹æ·»åŠ åˆ†ç±»è¿‡æ»¤ -->
                <div class="filter-group">
                    <button class="filter-btn active" data-category="all">å…¨éƒ¨</button>
                    <button class="filter-btn" data-category="ä¸»é£Ÿ">ä¸»é£Ÿ</button>
                    <button class="filter-btn" data-category="é¥®æ–™">é¥®æ–™</button>
                    <button class="filter-btn" data-category="å°åƒ">å°åƒ</button>
                </div>

                <!-- ä¿®æ”¹èœå“ç®¡ç†åŒºåŸŸçš„è¡¨å•éƒ¨åˆ† -->
                <div class="dish-form">
                    <h3>æ–°å¢èœå“</h3>
                    <div class="form-group">
                        <input type="text" id="dish-name" placeholder="èœå“åç§°" required>
                        <input type="number" id="dish-price" placeholder="ä»·æ ¼" min="0" step="0.01" required>
                        <select id="dish-category">
                            <option value="">é€‰æ‹©åˆ†ç±»</option>
                            <option value="ä¸»é£Ÿ">ä¸»é£Ÿ</option>
                            <option value="é¥®æ–™">é¥®æ–™</option>
                            <option value="å°åƒ">å°åƒ</option>
                        </select>
                        <button class="user-btn add-dish-btn">ä¸Šæ¶èœå“</button>
                        <div class="error-msg" id="dish-error" style="display: none"></div>
                    </div>
                </div>

                <!-- æ–°å¢ç¼–è¾‘è¡¨å•æ¨¡æ¿ -->
                <div class="edit-form-overlay" style="display: none;">
                    <div class="edit-form">
                        <h3>ä¿®æ”¹èœå“ä¿¡æ¯</h3>
                        <form id="edit-dish-form">
                            <div class="form-group">
                                <input type="text" id="edit-dish-name" required>
                                <input type="number" id="edit-dish-price" min="0" step="0.01" required>
                                <select id="edit-dish-category">
                                    <option value="ä¸»é£Ÿ">ä¸»é£Ÿ</option>
                                    <option value="é¥®æ–™">é¥®æ–™</option>
                                    <option value="å°åƒ">å°åƒ</option>
                                </select>
                            </div>
                            <div class="form-actions">
                                <button type="button" class="user-btn cancel-edit">å–æ¶ˆ</button>
                                <button type="submit" class="user-btn confirm-edit">ä¿å­˜ä¿®æ”¹</button>
                            </div>
                        </form>
                    </div>
                </div>


                <div class="dish-list"></div>
            </section>




            <!-- è®¢å•ç®¡ç†åŒºåŸŸ -->
            <section id="orders" style="display: none;">
                <div class="section-header">
                    <h2>è®¢å•ç®¡ç†</h2>
                    <div class="filter-group">
                        <button class="filter-btn active" data-status="all">å…¨éƒ¨è®¢å•</button>
                        <button class="filter-btn" data-status="pending">å¾…æ¥å•</button>
                        <button class="filter-btn" data-status="active">é…é€ä¸­</button>
                        <button class="filter-btn" data-status="completed">å·²å®Œæˆ</button>
                    </div>
                </div>

                <!-- è®¢å•åˆ—è¡¨å®¹å™¨ -->
                <div class="order-list" id="orders-container">
                    <!-- è®¢å•æ¨¡æ¿ -->

                </div>
            </section>

            <div id="global-templates" style="display: none;">
                <div class="dish-card template" style="display:none;" data-category="{{category}}">
                    <div class="dish-info">
                        <h3 class="dish-name"></h3>
                        <p>ä»·æ ¼ï¼šÂ¥<span class="dish-price"></span></p>
                        <p>åˆ†ç±»ï¼š<span class="dish-category">æš‚æ— åˆ†ç±»</span></p>
                    </div>
                    <div class="dish-actions">
                        <button class="edit-btn user-btn">ä¿®æ”¹</button>
                        <button class="delete-btn user-btn danger">ä¸‹æ¶</button>
                    </div>
                </div>

                <div class="merchant-order-card template" style="display: none;">
                    <div class="order-header">
                        <span class="order-id">è®¢å•å·ï¼š<span class="value"></span></span>
                        <span class="order-status">
                            <span class="status-dot"></span>
                            <span class="status-text"></span>
                        </span>
                    </div>

                    <div class="order-body">
                        <div class="customer-info">
                            <h4>å®¢æˆ·ä¿¡æ¯</h4>
                            <p>å§“åï¼š<span class="customer-name"></span></p>
                            <p>ç”µè¯ï¼š<span class="customer-phone"></span></p>
                            <p>åœ°å€ï¼š<span class="customer-address"></span></p>
                        </div>

                        <div class="dishes-list">
                            <h4>èœå“è¯¦æƒ…</h4>
                            <div class="dishes-items"></div>
                            <div class="order-total">
                                æ€»ä»·ï¼šÂ¥<span class="total-price"></span>
                            </div>
                        </div>

                        <div class="rider-info" style="display: none;">
                            <h4>éª‘æ‰‹ä¿¡æ¯</h4>
                            <p>å§“åï¼š<span class="rider-name"></span></p>
                            <p>ç”µè¯ï¼š<span class="rider-phone"></span></p>
                        </div>
                    </div>
                </div>
            </div>>

            <!-- åº—é“ºè®¾ç½®åŒºåŸŸ -->
            <section id="settings" style="display: none;">
                <h2>åº—é“ºè®¾ç½®</h2>
                <div class="settings-form">
                    <form id="merchant-settings-form">
                        <div class="form-group">
                            <label>åº—é“ºåç§°:  </label>
                            <input type="text" id="merchant-name" required>
                        </div>
                        <div class="form-group">
                            <label>è”ç³»ç”µè¯</label>
                            <input type="tel" id="merchant-phone" required>
                        </div>
                        <div class="form-group">
                            <label>åº—é“ºåœ°å€</label>
                            <textarea id="merchant-address" rows="3" required></textarea>
                        </div>

                        <div class="error-msg" id="settings-error" style="display: none"></div>
                        <div class="form-actions">
                            <button type="submit" class="user-btn">ä¿å­˜è®¾ç½®</button>
                        </div>
                    </form>
                </div>

                <div class="password-form" style="margin-top: 32px; border-top: 1px solid #eee; padding-top: 24px;">
                    <h3>ä¿®æ”¹å¯†ç </h3>
                    <form id="change-password-form">
                        <div class="form-group">
                            <label>æ—§å¯†ç </label>
                            <input type="password" id="old-password" required>
                        </div>
                        <div class="form-group">
                            <label>æ–°å¯†ç </label>
                            <input type="password" id="new-password" required>
                        </div>
                        <div class="form-group">
                            <label>ç¡®è®¤æ–°å¯†ç </label>
                            <input type="password" id="confirm-password" required>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="user-btn">ä¿®æ”¹å¯†ç </button>
                        </div>
                        <div class="error-msg" id="password-error" style="display: none"></div>
                    </form>
                </div>
            </section>
        </main>
    </div>

    <!-- åŠ è½½åŠ¨ç”»è’™å±‚ -->
    <div class="loading-mask">
        <div class="loading-spinner"></div>
    </div>

    <script>
        let currentSearchState = {
            keyword: '',
            category: 'all'
        };
    /* ===================== é¡µé¢ä¸»æ§åˆ¶å™¨ ===================== */
    document.addEventListener('DOMContentLoaded', () => {
        // ------------------ åˆå§‹åŒ–é˜¶æ®µ ------------------
        // åˆ›å»ºå¯¼èˆªç®¡ç†å®ä¾‹
        window.navigationManager = new NavigationManager();

        // åˆ›å»ºåŠ è½½è’™å±‚
        const loadingMask = document.createElement('div');
        loadingMask.className = 'loading-mask';
        document.body.appendChild(loadingMask);



        // ------------------ äº‹ä»¶ç»‘å®šé˜¶æ®µ ------------------
        // æœç´¢æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        document.querySelector('.search-btn').addEventListener('click', handleSearch);

        // åˆ†ç±»æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                // ç§»é™¤æ‰€æœ‰æŒ‰é’®æ¿€æ´»çŠ¶æ€
                document.querySelectorAll('.filter-btn').forEach(b =>
                    b.classList.remove('active'));

                // è®¾ç½®å½“å‰åˆ†ç±»
                currentSearchState.category = this.dataset.category;
                this.classList.add('active');

                // è§¦å‘æœç´¢
                triggerSearch();
            });
        });

        // è¾“å…¥æ¡†å®æ—¶æœç´¢ï¼ˆå¸¦é˜²æŠ–ï¼‰
        let searchTimeout;
        document.getElementById('dish-search').addEventListener('input', function() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                handleSearch();
            }, 300);
        });


        // äº‹ä»¶å§”æ‰˜ï¼ˆåªéœ€ç»‘å®šä¸€æ¬¡ï¼‰
        document.querySelector('.dish-list').addEventListener('click', function (e) {
            const deleteBtn = e.target.closest('.delete-btn');
            if (!deleteBtn) return;

            const dishId = deleteBtn.closest('.dish-card').dataset.dishId;

        });


        // èœå“ç®¡ç†ç›¸å…³äº‹ä»¶
        initDishManagement(navigationManager, loadingMask);

        // åº—é“ºè®¾ç½®ç›¸å…³äº‹ä»¶
        initSettingsManagement(loadingMask);

        // å…¬å…±UIäº‹ä»¶ï¼ˆä¾§è¾¹æ å“åº”å¼å¤„ç†ï¼‰
        initUIEvents();

        // æ–°å¢ç¼–è¾‘è¡¨å•åˆå§‹åŒ–
        initEditForm(navigationManager);

        // ------------------ æµè§ˆå™¨å†å²è®°å½•å¤„ç† ------------------
        window.addEventListener('popstate', (event) => {
            if (event.state && event.state.section) {
                navigationManager.switchSection(event.state.section);
            }
        });
    });

    /* ===================== å¯¼èˆªç®¡ç†ç±» ===================== */
    class NavigationManager {
        constructor() {
            this.currentSection = null;
            this.initNavigation();
            this.initDynamicElements();
            this.templates = {
                dish: document.querySelector('#global-templates .dish-card.template'),
                order: document.querySelector('#global-templates .merchant-order-card.template')
            };
            if (!this.templates.dish || !this.templates.order) {
                console.error('æ¨¡æ¿å…ƒç´ æœªåˆå§‹åŒ–');
            }
        }

        /* --------------- åˆå§‹åŒ–æ–¹æ³• --------------- */
        initNavigation() {
            // ç»‘å®šå¯¼èˆªç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', e => this.handleNavClick(e));
            });

            // åˆå§‹åŒ–æ˜¾ç¤ºç¬¬ä¸€ä¸ªæ ‡ç­¾é¡µ
            this.switchSection(this.getInitialSection());
        }

        initDynamicElements() {
            // ç§»åŠ¨ç«¯èœå•åˆ‡æ¢
            const sidebar = document.querySelector('.sidebar');
            const menuToggle = document.querySelector('.menu-toggle');

            menuToggle.addEventListener('click', () => {
                sidebar.classList.toggle('active');
                document.body.classList.toggle('no-scroll');
            });

            // çª—å£å¤§å°å˜åŒ–ç›‘å¬
            window.addEventListener('resize', () => {
                if (window.innerWidth > 768) {
                    sidebar.classList.remove('active');
                    document.body.classList.remove('no-scroll');
                }
            });
        }

        /* --------------- æ ¸å¿ƒåŠŸèƒ½æ–¹æ³• --------------- */
        // åŠ è½½èœå“æ•°æ®
        async loadDishes() {
            try {
                const response = await fetch('/api/dishes/', {  // ä¿®æ”¹è¯·æ±‚åœ°å€
                    method: 'GET',
                    credentials: 'include'
                });

                if (!response.ok) throw new Error(`HTTPé”™è¯¯ ${response.status}`);
                const dishes = await response.json();
                this.renderDishList(dishes);

            } catch (error) {
                this.showError('dishes', 'åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•');
                console.error('èœå“åŠ è½½å¤±è´¥:', error);
            }
        }

        // åŠ è½½åº—é“ºè®¾ç½®
        async loadSettings() {
            try {
                const response = await fetch('/api/merchant/settings/', {
                    method: 'GET',
                    credentials: 'include'
                });

                if (!response.ok) throw new Error(`HTTPé”™è¯¯ ${response.status}`);

                const data = await response.json();
                this.populateSettingsForm(data);

            } catch (error) {
                console.error('åŠ è½½è®¾ç½®å¤±è´¥:', error);
                this.showError('settings', 'åŠ è½½è®¾ç½®å¤±è´¥');
            }
        }

        /* --------------- é¡µé¢æ¸²æŸ“æ–¹æ³• --------------- */

        // æ¸²æŸ“èœå“åˆ—è¡¨
        renderDishList(dishes) {
            const dishList = document.querySelector('.dish-list');
            dishList.innerHTML = ''; // æ¸…ç©ºç°æœ‰å†…å®¹

            if (!dishes || dishes.length === 0) {
                dishList.innerHTML = '<div class="no-result">æœªæ‰¾åˆ°ç›¸å…³èœå“</div>';
                return;
            }

            // ä½¿ç”¨æ¨¡æ¿åˆ›å»ºå¡ç‰‡
            const template = document.querySelector('.dish-card.template');
            dishes.forEach(dish => {
                const clone = template.cloneNode(true);
                clone.style.display = 'flex';
                clone.dataset.dishId = dish.id;

                // å¡«å……æ•°æ®
                clone.querySelector('.dish-name').textContent = dish.name;
                clone.querySelector('.dish-price').textContent = dish.price.toFixed(2);
                clone.querySelector('.dish-category').textContent = dish.category || 'æœªåˆ†ç±»';

                // ç»‘å®šäº‹ä»¶
                clone.querySelector('.edit-btn').addEventListener('click', () =>
                    this.showEditForm(dish));
                clone.querySelector('.delete-btn').addEventListener('click', () =>
                    this.handleDeleteDish(dish.id));

                dishList.appendChild(clone);
            });
        }

        // åˆ›å»ºå•ä¸ªèœå“å¡ç‰‡
        createDishCard(dish, template) {
            const clone = template.cloneNode(true);
            clone.classList.remove('template');
            clone.style.display = 'flex';
            clone.dataset.dishId = dish.id;

            // å¡«å……æ•°æ®
            clone.querySelector('.dish-name').textContent = dish.name;
            clone.querySelector('.dish-price').textContent = Number(dish.price).toFixed(2);
            clone.querySelector('.dish-category').textContent = dish.category || 'æœªåˆ†ç±»';

            // ç»‘å®šäº‹ä»¶
            clone.querySelector('.edit-btn').addEventListener('click', () => this.showEditForm(dish));
            clone.querySelector('.delete-btn').addEventListener('click', () => this.handleDeleteDish(dish, clone));

            return clone;
        }

        /* --------------- äº‹ä»¶å¤„ç†æ–¹æ³• --------------- */
        // å¤„ç†å¯¼èˆªç‚¹å‡»
        handleNavClick(event) {
            event.preventDefault();
            const targetSection = event.target.dataset.type;
            this.switchSection(targetSection);
            this.updateURL(targetSection);
        }

        // åœ¨NavigationManagerç±»ä¸­ä¿®æ”¹åˆ é™¤æ–¹æ³•
        async handleDeleteDish(dishId) {
            if (!confirm(`ç¡®è®¤ä¸‹æ¶è¯¥èœå“ï¼Ÿ`)) return;

            try {
                const response = await fetch(`/api/dishes/${dishId}/`, { // ç¡®ä¿ä½¿ç”¨æ¨¡æ¿å­—ç¬¦ä¸²
                    method: 'DELETE',
                    credentials: 'include'
                });

                if (response.ok) {
                    const dishCard = document.querySelector(`[data-dish-id="${dishId}"]`);
                    if (dishCard) dishCard.remove();
                    this.showToast("ä¸‹æ¶æˆåŠŸ", "success");
                } else {
                    this.showError('dishes', 'ä¸‹æ¶å¤±è´¥: ' + (await response.text()));
                }
            } catch (error) {
                this.showError('dishes', 'ç½‘ç»œé”™è¯¯: ' + error.message);
            }
        }

        /* --------------- è¾…åŠ©æ–¹æ³• --------------- */

        // åˆ‡æ¢åŠŸèƒ½æ¨¡å—
        switchSection(sectionId) {
            // éšè—æ‰€æœ‰æ¨¡å—
            document.querySelectorAll('section').forEach(section =>
                section.style.display = 'none'
            );

            // æ˜¾ç¤ºç›®æ ‡æ¨¡å—
            const target = document.getElementById(sectionId);
            if (target) {
                target.style.display = 'block';
                this.currentSection = sectionId;
                this.loadSectionData(sectionId);
            }

            // æ›´æ–°å¯¼èˆªæ¿€æ´»çŠ¶æ€
            this.updateNavActiveState(sectionId);
        }

        // æ›´æ–°æµè§ˆå™¨URL
        updateURL(sectionId) {
            const newUrl = `${window.location.pathname}?type=${sectionId}`;
            window.history.pushState({section: sectionId}, '', newUrl);
        }

        // å¡«å……åº—é“ºè®¾ç½®è¡¨å•
        populateSettingsForm(data) {
            document.getElementById('merchant-name').value = data.name || '';
            document.getElementById('merchant-phone').value = data.phone || '';
            document.getElementById('merchant-address').value = data.address || '';
        }

        // æ›´æ–°å¯¼èˆªæ¿€æ´»çŠ¶æ€
        updateNavActiveState(sectionId) {
            document.querySelectorAll('.nav-link').forEach(link =>
                link.classList.toggle('active', link.dataset.type === sectionId)
            );
        }

        // åŠ è½½æ¨¡å—æ•°æ®
        async loadSectionData(sectionId) {
            switch (sectionId) {
                case 'dishes':
                    await this.loadDishes();
                    break;
                case 'orders':
                    await this.loadOrders();
                    break;
                case 'settings':
                    await this.loadSettings();
                    break;
            }
        }

        // æ˜¾ç¤ºç¼–è¾‘è¡¨å•
        showEditForm(dish) {
            const overlay = document.querySelector('.edit-form-overlay');
            const form = document.getElementById('edit-dish-form');

            // å¡«å……å½“å‰æ•°æ®
            document.getElementById('edit-dish-name').value = dish.name;
            document.getElementById('edit-dish-price').value = dish.price;
            document.getElementById('edit-dish-category').value = dish.category || '';

            // æ˜¾ç¤ºè¡¨å•å¹¶ä¿å­˜ID
            overlay.style.display = 'flex';
            form.dataset.dishId = dish.id;
        }

        /* --------------- æ–°å¢ç­›é€‰æ ¸å¿ƒæ–¹æ³• --------------- */
        filterOrders(status, target) {
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('#orders .filter-btn').forEach(b =>
                b.classList.remove('active')
            );
            if(target) target.classList.add('active');
            // è¿‡æ»¤è®¢å•
            document.querySelectorAll('#orders-container .merchant-order-card').forEach(order => {
                const shouldShow = status === 'all' || order.dataset.status === status;
                order.style.display = shouldShow ? 'block' : 'none';
            });
        }

        // è®¢å•åŠ è½½æ–¹æ³•ï¼ˆç¤ºä¾‹ï¼‰
        async loadOrders() {
            try {
                const container = document.getElementById('orders-container');
                const template = document.querySelector('#global-templates .merchant-order-card.template');

                if (!template) {
                  throw new Error('æœªæ‰¾åˆ°è®¢å•æ¨¡æ¿');
                }
                container.innerHTML = '<div class="loading-text">åŠ è½½è®¢å•ä¸­...</div>';

                const response = await fetch('/api/merchant/orders/', {
                    method: 'GET',
                    credentials: 'include'
                });

                if (!response.ok) throw new Error(`HTTPé”™è¯¯ ${response.status}`);
                const orders = await response.json();
                this.renderOrders(orders);
                this.filterOrders('all', document.querySelector('#orders .filter-btn[data-status="all"]'));

            } catch (error) {
                console.error('è®¢å•åŠ è½½å¤±è´¥:', error);
                this.showError('orders', 'åŠ è½½è®¢å•å¤±è´¥');
            }
        }

        // è®¢å•æ¸²æŸ“æ–¹æ³•
        renderOrders(orders) {
            const statusMap = {
                "pending": "pending",
                "active": "active",
                "completed": "completed",
                "canceled": "canceled"
            };
            const container = document.getElementById('orders-container');
            container.innerHTML = '';

            orders.forEach(order => {
                const clone = this.templates.order.cloneNode(true);

                // ä¿®æ­£çŠ¶æ€å¤„ç†é€»è¾‘
                const originalStatus = order.status.toLowerCase();
                const displayStatus = statusMap[originalStatus] || originalStatus;
                clone.dataset.status = originalStatus;

                // çŠ¶æ€æ˜¾ç¤ºæ–‡æœ¬ï¼ˆä¸å½±å“è¿‡æ»¤é€»è¾‘ï¼‰
                clone.querySelector('.status-text').textContent = {
                    pending: 'å¾…æ¥å•',
                    active: 'é…é€ä¸­',
                    completed: 'å·²å®Œæˆ',
                    canceled: 'å·²å–æ¶ˆ'
                }[originalStatus];


                // åœ¨renderOrdersæ–¹æ³•ä¸­æ·»åŠ è°ƒè¯•è¾“å‡º
                console.log('Order Status:', originalStatus, 'DOM Status:', clone.dataset.status);


                // å¡«å……çŠ¶æ€æ˜¾ç¤º
                clone.querySelector('.status-text').textContent = displayStatus;
                clone.querySelector('.status-dot').style.backgroundColor = this.getStatusColor(originalStatus);

                // å¡«å……è®¢å•æ•°æ®
                clone.querySelector('.order-id .value').textContent = order.oid;
                clone.querySelector('.order-total .total-price').textContent = order.total_price.toFixed(2);
                clone.querySelector('.customer-phone').textContent = order.customer_info.phone || 'æœªæä¾›';

                // å¡«å……å®¢æˆ·ä¿¡æ¯
                clone.querySelector('.customer-name').textContent = order.customer_info.name;
                clone.querySelector('.customer-address').textContent = order.customer_info.address;


                clone.classList.remove('template');
                clone.style.display = 'block';
                clone.dataset.status = order.status.toLowerCase(); // çŠ¶æ€è½¬ä¸ºå°å†™
                clone.dataset.status = statusMap[order.status] || order.status.toLowerCase();



                // å¡«å……èœå“ä¿¡æ¯
                const dishesContainer = clone.querySelector('.dishes-items');
                dishesContainer.innerHTML = '';
                order.dishes.forEach(dish => {
                    const div = document.createElement('div');
                    div.className = 'dish-item';
                    div.innerHTML = `
                        <span>${dish.name}</span>
                        <span>æ•°é‡ï¼š${dish.quantity}</span>
                        <span>å•ä»·ï¼šÂ¥${dish.price.toFixed(2)}</span>
                        <span>å°è®¡ï¼šÂ¥${dish.subtotal.toFixed(2)}</span>
                    `;
                    dishesContainer.appendChild(div);
                });

                // ä¿®æ”¹éª‘æ‰‹ä¿¡æ¯æ˜¾ç¤ºé€»è¾‘
                if (order.rider_info) {
                    const riderSection = clone.querySelector('.rider-info');
                    riderSection.style.display = 'block';  // ç§»é™¤å†…è”çš„display:none
                    riderSection.querySelector('.rider-name').textContent = order.rider_info.name;
                    riderSection.querySelector('.rider-phone').textContent = order.rider_info.phone;
                }

                container.appendChild(clone);
            });

            // åˆå§‹åŒ–è¿‡æ»¤åŠŸèƒ½ï¼ˆç›´æ¥å®šä¹‰å‡½æ•°ï¼‰
            const filterOrders = (status, target) => {
                document.querySelectorAll('#orders .filter-btn').forEach(b =>
                    b.classList.remove('active'));
                target.classList.add('active');

                document.querySelectorAll('#orders .merchant-order-card').forEach(order => {
                    const orderStatus = order.dataset.status;
                    const shouldShow = status === 'all' || orderStatus === status;
                    order.style.display = shouldShow ? 'block' : 'none';
                });
            };

            // ç»‘å®šè¿‡æ»¤æŒ‰é’®äº‹ä»¶
            document.querySelectorAll('#orders .filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    filterOrders(this.dataset.status, this); // ä¼ é€’statuså’Œtarget
                });
            });
        }


        getStatusColor(status) {
            const colorMap = {
                pending: '#FFB020',
                active: '#4091F7',
                completed: '#14C9A2'
            };
            return colorMap[status.toLowerCase()] || '#999';
        }

        // è·å–åˆå§‹æ˜¾ç¤ºæ¨¡å—
        getInitialSection() {
            const params = new URLSearchParams(window.location.search);
            return params.get('type') || 'dishes';
        }

        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ï¼ˆåŸç¼ºå¤±ï¼‰
        showError(sectionId, message) {
            const errorElement = document.querySelector(`#${sectionId} .error-msg`);
            if (errorElement) {
                errorElement.textContent = message;
                setTimeout(() => errorElement.textContent = '', 3000);
            }
        }

        // ä¿å­˜èœå“ä¿®æ”¹ï¼ˆåŸåœ¨æ³¨é‡Šä¸­ï¼‰
        async saveDishChanges(dishId, newData) {
            try {
                const response = await fetch(`/api/dishes/${dishId}/`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    credentials: 'include',
                    body: JSON.stringify(newData)
                });

                {#// æ·»åŠ çŠ¶æ€ç å’Œå“åº”å†…å®¹æ—¥å¿—#}
                {#console.log('HTTPçŠ¶æ€ç :', response.status);#}
                {#const responseText = await response.text();#}
                {#console.log('å“åº”å†…å®¹:', responseText);#}

                if (!response.ok) {
                    const error = responseText ? JSON.parse(responseText) : {};
                    throw new Error(error.message || 'ä¿å­˜å¤±è´¥');
                }

                await this.loadDishes();
                return true;

            } catch (error) {
                //console.error('å®Œæ•´é”™è¯¯ä¿¡æ¯:', error);
                alert(error.message);
                return false;
            }
        }
    }

    /* ===================== åŠŸèƒ½æ¨¡å—åˆå§‹åŒ– ===================== */
    // åˆå§‹åŒ–èœå“ç®¡ç†åŠŸèƒ½
    function initDishManagement(navManager, loadingMask) {
        const addBtn = document.querySelector('.add-dish-btn');

        addBtn.addEventListener('click', async (e) => {
            e.preventDefault(); // æ–°å¢è¿™è¡Œé˜»æ­¢é»˜è®¤è¡Œä¸º
            const nameInput = document.getElementById('dish-name');
            const priceInput = document.getElementById('dish-price');
            const categorySelect = document.getElementById('dish-category');
            const errorDiv = document.getElementById('dish-error');
            errorDiv.textContent = '';

            // å‰ç«¯éªŒè¯
            if (!validateDishForm(nameInput, priceInput, categorySelect, errorDiv)) return;

            loadingMask.style.display = 'block';

            try {
                console.log('å‘é€èœå“åˆ›å»ºè¯·æ±‚', {
                    name: nameInput.value.trim(),
                    price: parseFloat(priceInput.value),
                    category: categorySelect.value
                });
                const response = await fetch('/api/dishes/', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    credentials: 'include',
                    body: JSON.stringify({
                        name: nameInput.value.trim(),
                        price: parseFloat(priceInput.value),
                        category: categorySelect.value
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    resetDishForm(nameInput, priceInput, categorySelect);
                    await navManager.loadDishes();
                } else {
                    errorDiv.textContent = data.error || 'ä¿å­˜å¤±è´¥';
                }
            } catch (error) {
                console.error('æ·»åŠ èœå“é”™è¯¯:', error); // æ–°å¢é”™è¯¯æ—¥å¿—
                errorDiv.textContent = 'ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥è¿æ¥';
            } finally {
                loadingMask.style.display = 'none';
            }
        });
    }

    // åˆå§‹åŒ–åº—é“ºè®¾ç½®åŠŸèƒ½
    function initSettingsManagement(loadingMask) {
        const settingForm = document.getElementById('merchant-settings-form');

        settingForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            loadingMask.style.display = 'block';

            const formData = {
                name: document.getElementById('merchant-name').value.trim(),
                phone: document.getElementById('merchant-phone').value.trim(),
                address: document.getElementById('merchant-address').value.trim()
            };

            const errorDiv = document.getElementById('settings-error');
            errorDiv.textContent = '';

            if (!validateSettingsForm(formData, errorDiv)) return;

            try {
                const response = await fetch('/api/merchant/settings/', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    credentials: 'include',
                    body: JSON.stringify(formData)
                });

                const data = await response.json();

                if (response.ok) {
                    alert('è®¾ç½®å·²ä¿å­˜');
                    updateWelcomeMessage(formData.name);
                } else {
                    errorDiv.textContent = data.error || 'ä¿å­˜å¤±è´¥';
                }
            } catch (error) {
                errorDiv.textContent = 'ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥è¿æ¥';
            } finally {
                loadingMask.style.display = 'none';
            }
        });
    }

    // ç‹¬ç«‹åˆå§‹åŒ–ç¼–è¾‘è¡¨å•
    function initEditForm(navManager) {
        const editForm = document.getElementById('edit-dish-form');
        const overlay = document.querySelector('.edit-form-overlay');

        editForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const dishId = editForm.dataset.dishId;
            const newData = {
                name: document.getElementById('edit-dish-name').value.trim(),
                price: parseFloat(document.getElementById('edit-dish-price').value),
                category: document.getElementById('edit-dish-category').value
            };

            if (await navManager.saveDishChanges(dishId, newData)) {
                overlay.style.display = 'none';
            }
        });
    }

    /* ===================== å·¥å…·å‡½æ•° ===================== */
    // æ–°å¢åº—é“ºè®¾ç½®è¡¨å•éªŒè¯
    // å¢å¼ºéªŒè¯å‡½æ•°ï¼ˆå¤„ç†å¤šä¸ªé”™è¯¯ï¼‰
    function validateSettingsForm(formData, errorDiv) {
        const errors = [];

        if (!formData.name) errors.push('åº—é“ºåç§°ä¸èƒ½ä¸ºç©º');
        if (!formData.phone) errors.push('æ‰‹æœºå·ç ä¸èƒ½ä¸ºç©º');
        if (!formData.address) errors.push('åº—é“ºåœ°å€ä¸èƒ½ä¸ºç©º');

        if (errors.length > 0) {
            errorDiv.textContent = errors.join('ï¼Œ');
            return false;
        }
        return true;
    }


    // éªŒè¯èœå“è¡¨å•
    function validateDishForm(nameInput, priceInput, categorySelect, errorDiv) {
        if (!nameInput.value.trim()) {
            errorDiv.textContent = 'è¯·è¾“å…¥èœå“åç§°';
            return false;
        }
        if (isNaN(priceInput.value) || priceInput.value <= 0) {
            errorDiv.textContent = 'è¯·è¾“å…¥æœ‰æ•ˆä»·æ ¼';
            return false;
        }
        if (!categorySelect.value) { // æ–°å¢åˆ†ç±»éªŒè¯
            errorDiv.textContent = 'è¯·é€‰æ‹©èœå“åˆ†ç±»';
            return false;
        }
        return true;
    }

    // é‡ç½®èœå“è¡¨å•
    function resetDishForm(nameInput, priceInput, categorySelect) {
        nameInput.value = '';
        priceInput.value = '';
        categorySelect.value = '';
    }

    // æ›´æ–°æ¬¢è¿ä¿¡æ¯
    function updateWelcomeMessage(name) {
        document.querySelector('.user-btn:first-child').textContent = `æ¬¢è¿æ‚¨ï¼Œ${name}`;
    }

    // åˆå§‹åŒ–UIäº‹ä»¶
    function initUIEvents() {
        const overlay = document.querySelector('.edit-form-overlay');

        // å–æ¶ˆç¼–è¾‘æŒ‰é’®
        document.querySelector('.cancel-edit').addEventListener('click', () => {
            overlay.style.display = 'none';
        });

        // ç‚¹å‡»é®ç½©å±‚å…³é—­
        overlay.addEventListener('click', (e) => {
            if (e.target === overlay) overlay.style.display = 'none';
        });
    }

    /* ===================== æœç´¢åŠŸèƒ½ ===================== */
    let currentSearchKeyword = '';
    let currentCategory = 'all';

    // æœç´¢æŒ‰é’®ç‚¹å‡»äº‹ä»¶
    function handleSearch() {
        currentSearchKeyword = document.getElementById('dish-search').value.trim();
        triggerSearch();
    }

    // å®æ—¶è¾“å…¥ç›‘å¬ï¼ˆå¯é€‰ï¼‰
    document.getElementById('dish-search').addEventListener('input', function () {
        currentSearchKeyword = this.value.trim();
        triggerSearch();
    });

    // åˆ†ç±»è¿‡æ»¤å¤„ç†
    function handleFilter(category) {
        // æ›´æ–°æŒ‰é’®çŠ¶æ€
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.classList.toggle('active', btn.dataset.category === category);
        });

        currentCategory = category;
        triggerSearch();
    }

    // å¢å¼ºæœç´¢åŠŸèƒ½
    async function triggerSearch() {
        try {
            const params = new URLSearchParams({
                keyword: document.getElementById('dish-search').value.trim(),
                category: currentSearchState.category
            });

            const response = await fetch(`/api/dishes/search/?${params}`);
            if (!response.ok) throw new Error(`HTTPé”™è¯¯ ${response.status}`);

            const dishes = await response.json();
            window.navigationManager.renderDishList(dishes);
        } catch (error) {
            console.error('æœç´¢å¤±è´¥:', error);
            document.getElementById('dish-error').style.display = 'block';
            document.getElementById('dish-error').textContent = 'æœç´¢å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•';
        }
    }


    // åœ¨<script>æ ‡ç­¾å†…æ·»åŠ 
    document.getElementById('change-password-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const form = e.target;
        const errorDiv = document.getElementById('password-error');
        errorDiv.style.display = 'none';

        const oldPassword = document.getElementById('old-password').value;
        const newPassword = document.getElementById('new-password').value;
        const confirmPassword = document.getElementById('confirm-password').value;

        // å‰ç«¯éªŒè¯
        if (newPassword !== confirmPassword) {
            errorDiv.textContent = 'æ–°å¯†ç ä¸¤æ¬¡è¾“å…¥ä¸ä¸€è‡´';
            errorDiv.style.display = 'block';
            return;
        }

        try {
            const response = await fetch('/api/merchant/change-password/', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                credentials: 'include',
                body: JSON.stringify({
                    old_password: oldPassword,
                    new_password: newPassword
                })
            });

            const data = await response.json();

            if (response.ok) {
                alert('å¯†ç ä¿®æ”¹æˆåŠŸï¼Œè¯·é‡æ–°ç™»å½•');
                window.location.href = '/logout/';
            } else {
                errorDiv.textContent = data.error || 'å¯†ç ä¿®æ”¹å¤±è´¥';
                errorDiv.style.display = 'block';
            }
        } catch (error) {
            errorDiv.textContent = 'ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•';
            errorDiv.style.display = 'block';
        }
    });

</script>

</body>
</html>